<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¶</title>
<style>
  :root{
    --pink:#f9748f;
    --pink-dark:#f0657b;
    --mint:#94d3ac;
    --teal:#2b7a6b;
    --bg:#ffe6f0;
    --fertile:#ffe4ec;    /* Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø£ÙƒØ«Ø± Ø®ØµÙˆØ¨Ø© */
    --ovul:#ffd166;       /* ÙŠÙˆÙ… Ø§Ù„Ø¥Ø¨Ø§Ø¶Ø© */
    --period:#c7e9ff;     /* Ø£ÙŠØ§Ù… Ø§Ù„Ø¯ÙˆØ±Ø© */
    --card:#fff7f9;
  }
  body{
    font-family: Arial, sans-serif;
    direction: rtl;
    text-align: center;
    padding: 20px;
    background: linear-gradient(135deg, var(--bg), #ffffff);
    min-height: 100vh;
    margin: 0;
    color: #333;
  }
  header.fancy-header{
    font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size:42px;font-weight:700;
    background:linear-gradient(90deg,#f78ca0,var(--pink));
    background-clip:text;-webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    text-shadow:1px 1px 2px rgba(247,140,160,.5);
    margin-bottom:20px;user-select:none;
  }
  .lang-select{margin-bottom:30px;display:inline-flex;gap:15px;justify-content:center;flex-wrap:wrap;}
  .lang-btn{
    cursor:pointer;background-color:var(--pink);border:none;color:#fff;font-weight:600;font-size:16px;
    padding:12px 30px;border-radius:30px;box-shadow:0 4px 10px rgba(249,116,143,.3);
    transition:background-color .3s, transform .2s;user-select:none;min-width:120px;text-align:center;flex-shrink:0;
  }
  .lang-btn:hover{background-color:var(--pink-dark);transform:scale(1.05);box-shadow:0 6px 14px rgba(240,101,123,.5);}
  h2{font-size:28px;margin-bottom:15px;user-select:none;}
  label{display:block;margin-top:15px;font-size:18px;user-select:none;}
  input,button{
    padding:10px;margin:10px 0;font-size:16px;border-radius:6px;border:1.5px solid var(--pink);outline:none;
    width:100%;max-width:300px;box-sizing:border-box;transition:border-color .3s, box-shadow .3s;
  }
  input:focus{border-color:var(--pink-dark);box-shadow:0 0 6px #fbb6c1;}
  button{
    background-color:var(--pink);color:#fff;border:none;cursor:pointer;font-weight:bold;width:150px;user-select:none;
    border-radius:30px;box-shadow:0 4px 10px rgba(249,116,143,.3);transition:background-color .3s, transform .2s;
  }
  button:hover{background-color:var(--pink-dark);transform:scale(1.05);box-shadow:0 6px 14px rgba(240,101,123,.5);}

  .result{margin-top:18px;color:var(--teal);font-size:18px;min-height:80px;user-select:text;}
  .result .line{margin:6px 0;}
  .result .fertile-line{font-size:15px;opacity:.95} /* Ø£ØµØºØ± Ù„ÙŠØ¸Ù‡Ø± ÙÙŠ Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ */

  #cycleNotification{
    margin-top:12px;font-weight:bold;font-size:18px;border-radius:8px;padding:12px;display:none;max-width:320px;margin-inline:auto;
  }

  /* Ø´Ø§Ø±Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠØ© */
  .circle-date{
    display:inline-block;background-color:#fff3f6;border:2px solid var(--pink);color:var(--pink-dark);
    font-weight:bold;padding:8px 12px;border-radius:999px;margin:6px 4px;min-width:130px;
    box-shadow:0 2px 8px rgba(0,0,0,.06);
  }

  /* Ø§Ù„ØªÙ‚ÙˆÙŠÙ… */
  .calendar-wrap{max-width:720px;margin:18px auto 6px;background:#fff;border-radius:16px;padding:16px;
    box-shadow:0 10px 24px rgba(249,116,143,.12);}
  .cal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;gap:10px;}
  .cal-title{font-weight:700;}
  .cal-grid{
    display:grid;
    grid-template-columns: repeat(7, 1fr);
    gap:8px;
  }
  .dow{font-size:13px;font-weight:bold;opacity:.75}
  .day{
    aspect-ratio:1 / 1; /* Ù…Ø±Ø¨Ø¹ Ù…ØªØ¬Ø§ÙˆØ¨ */
    border-radius:12px;display:flex;align-items:center;justify-content:center;
    background:#fafafa;box-shadow:0 1px 3px rgba(0,0,0,.04);
    font-weight:600;
  }
  .day.muted{opacity:.35}
  .day.period{background:var(--period); box-shadow:0 6px 16px rgba(61,152,255,.25);}
  .day.fertile{background:var(--fertile);box-shadow:0 6px 16px rgba(249,116,143,.25);}
  .day.ovul{background:var(--ovul);  box-shadow:0 6px 16px rgba(255,209,102,.35); border:2px solid #e9a600;}
  .legend{display:flex;gap:12px;justify-content:center;align-items:center;flex-wrap:wrap;margin-top:10px}
  .legend .item{display:flex;align-items:center;gap:8px;font-size:14px;background:#fff;border-radius:999px;padding:6px 10px;box-shadow:0 2px 6px rgba(0,0,0,.06)}
  .swatch{width:14px;height:14px;border-radius:4px;box-shadow:inset 0 0 0 1px rgba(0,0,0,.06)}
  .swatch.period{background:var(--period)}
  .swatch.fertile{background:var(--fertile)}
  .swatch.ovul{background:var(--ovul)}

  /* Ù‚Ø³Ù… Ø§Ù„Ø³Ø¨Ø¨ ÙˆØ§Ù„Ù†ØµØ§Ø¦Ø­ */
  #reasonSection{margin-top:16px;display:none}
  .reason-btn{
    background-color:#ffc7d2;color:#6b2840;padding:8px 14px;border-radius:20px;border:none;margin:6px;cursor:pointer;
    box-shadow:0 2px 8px rgba(0,0,0,.06);
  }
  .reason-btn.conceive{background-color:var(--mint);color:#11402e}
  #adviceBox{
    margin-top:12px;max-width:680px;margin-inline:auto;text-align:start;background:var(--card);border-radius:12px;padding:14px;display:none;
    box-shadow:0 6px 18px rgba(0,0,0,.06)
  }
  #adviceBox strong{display:block;margin-bottom:8px}
  #adviceBox ul{margin:0;padding-inline-start:20px}
  #adviceBox li{margin:6px 0;line-height:1.5}

  .small-note{font-size:14px;color:#666;margin-top:8px}

  /* Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù†Øµ Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ© */
  [dir="ltr"] #adviceBox, [dir="ltr"] .small-note, [dir="ltr"] .legend .item{text-align:left}
</style>
</head>
<body>
  <header class="fancy-header">Mayan</header>

  <div class="lang-select" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ØºØ© / Select language / Choisir la langue">
    <button class="lang-btn" onclick="changeLang('ar')">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
    <button class="lang-btn" onclick="changeLang('en')">English</button>
    <button class="lang-btn" onclick="changeLang('fr')">FranÃ§ais</button>
  </div>

  <h2 id="title">Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¶</h2>

  <label id="labelLastPeriod" for="lastPeriod">Ø£ÙˆÙ„ ÙŠÙˆÙ… Ù…Ù† Ø¢Ø®Ø± Ø¯ÙˆØ±Ø© Ø´Ù‡Ø±ÙŠØ©:</label>
  <input type="date" id="lastPeriod" aria-describedby="labelLastPeriod" />

  <label id="labelCycleLength" for="cycleLength">Ø·ÙˆÙ„ Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ© (Ø¨Ø§Ù„Ø£ÙŠØ§Ù…):</label>
  <input type="number" id="cycleLength" value="28" min="21" max="35" aria-describedby="labelCycleLength" />

  <br />
  <button onclick="calculateOvulation()" id="btnCalculate">Ø§Ø­Ø³Ø¨ÙŠ Ø§Ù„Ø¢Ù†</button>

  <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
  <div class="result" id="result" role="region" aria-live="polite"></div>
  <div id="cycleNotification" role="alert" aria-live="assertive"></div>

  <!-- Ø§Ù„ØªÙ‚ÙˆÙŠÙ… -->
  <div id="calendarContainer" class="calendar-wrap" style="display:none">
    <div class="cal-header">
      <div class="cal-title" id="calTitle"></div>
    </div>
    <div class="cal-grid" id="calGrid"></div>
    <div class="legend" id="legend">
      <div class="item"><span class="swatch period"></span><span id="lgPeriod">Ø£ÙŠØ§Ù… Ø§Ù„Ø¯ÙˆØ±Ø©</span></div>
      <div class="item"><span class="swatch fertile"></span><span id="lgFertile">Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø£ÙƒØ«Ø± Ø®ØµÙˆØ¨Ø©</span></div>
      <div class="item"><span class="swatch ovul"></span><span id="lgOvul">ÙŠÙˆÙ… Ø§Ù„Ø¥Ø¨Ø§Ø¶Ø©</span></div>
    </div>
  </div>

  <!-- Ø³Ø¨Ø¨ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ù†ØµØ§Ø¦Ø­ -->
  <div id="reasonSection" aria-live="polite">
    <p id="reasonQuestion" class="small-note"></p>
    <button class="reason-btn conceive" onclick="showAdvice('conceive')"></button>
    <button class="reason-btn" onclick="showAdvice('prevent')"></button>
  </div>

  <div id="adviceBox" aria-live="polite"></div>

  <audio id="successSound" src="https://www.soundjay.com/buttons/sounds/button-3.mp3" preload="auto"></audio>

<script>
  const texts = {
    ar:{title:"Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¶",labelLastPeriod:"Ø£ÙˆÙ„ ÙŠÙˆÙ… Ù…Ù† Ø¢Ø®Ø± Ø¯ÙˆØ±Ø© Ø´Ù‡Ø±ÙŠØ©:",labelCycleLength:"Ø·ÙˆÙ„ Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ© (Ø¨Ø§Ù„Ø£ÙŠØ§Ù…):",
      btnCalculate:"Ø§Ø­Ø³Ø¨ÙŠ Ø§Ù„Ø¢Ù†",error:"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.",
      ovulation:"ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¨Ø§Ø¶Ø©:",fertileWindow:"ğŸŒ¸ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø£ÙƒØ«Ø± Ø®ØµÙˆØ¨Ø©:",
      to:"Ø¥Ù„Ù‰",regular:"Ø¯ÙˆØ±Ø© Ù…Ù†ØªØ¸Ù…Ø©",irregular:"Ø¯ÙˆØ±Ø© ØºÙŠØ± Ù…Ù†ØªØ¸Ù…Ø©",
      reasonQuestion:"Ù„Ù…Ø§Ø°Ø§ ØªØ¨Ø­Ø«ÙŠÙ† Ø¹Ù† Ø£ÙŠØ§Ù… Ø§Ù„Ø¥Ø¨Ø§Ø¶Ø©ØŸ",reasonConceive:"Ù„Ø²ÙŠØ§Ø¯Ø© ÙØ±Øµ Ø§Ù„Ø­Ù…Ù„",reasonPrevent:"Ù…Ù† Ø£Ø¬Ù„ Ù…Ù†Ø¹ Ø§Ù„Ø­Ù…Ù„",
      legend:{period:"Ø£ÙŠØ§Ù… Ø§Ù„Ø¯ÙˆØ±Ø©",fertile:"Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø£ÙƒØ«Ø± Ø®ØµÙˆØ¨Ø©",ovul:"ÙŠÙˆÙ… Ø§Ù„Ø¥Ø¨Ø§Ø¶Ø©"},
      nextPeriod:"ğŸ—“ï¸ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©:"
    },
    en:{title:"Ovulation Calculator",labelLastPeriod:"First day of last menstrual period:",
      labelCycleLength:"Cycle length (days):",btnCalculate:"Calculate Now",
      error:"Please enter all data correctly.",
      ovulation:"ğŸ“… Ovulation Date:",fertileWindow:"ğŸŒ¸ Most Fertile Days:",
      to:"to",regular:"Regular cycle",irregular:"Irregular cycle",
      reasonQuestion:"Why are you checking ovulation days?",reasonConceive:"Increase chance of pregnancy",reasonPrevent:"Avoid pregnancy",
      legend:{period:"Period days",fertile:"Most fertile days",ovul:"Ovulation day"},
      nextPeriod:"ğŸ—“ï¸ Expected start of next period:"
    },
    fr:{title:"Calculateur d'ovulation",labelLastPeriod:"Premier jour des derniÃ¨res rÃ¨gles:",
      labelCycleLength:"DurÃ©e du cycle (jours):",btnCalculate:"Calculer maintenant",
      error:"Veuillez entrer toutes les donnÃ©es correctement.",
      ovulation:"ğŸ“… Date d'ovulation:",fertileWindow:"ğŸŒ¸ Jours les plus fertiles:",
      to:"au",regular:"Cycle rÃ©gulier",irregular:"Cycle irrÃ©gulier",
      reasonQuestion:"Pourquoi vÃ©rifiez-vous les jours d'ovulation ?",reasonConceive:"Augmenter les chances de grossesse",reasonPrevent:"Ã‰viter une grossesse",
      legend:{period:"Jours des rÃ¨gles",fertile:"Jours les plus fertiles",ovul:"Jour d'ovulation"},
      nextPeriod:"ğŸ—“ï¸ DÃ©but prÃ©vu des prochaines rÃ¨gles :"
    }
  };

  const frenchMonthsInArabic=["Ø¬Ø§Ù†ÙÙŠ","ÙÙŠÙØ±ÙŠ","Ù…Ø§Ø±Ø³","Ø£ÙØ±ÙŠÙ„","Ù…Ø§ÙŠ","Ø¬ÙˆØ§Ù†","Ø¬ÙˆÙŠÙ„ÙŠØ©","Ø£ÙˆØª","Ø³Ø¨ØªÙ…Ø¨Ø±","Ø£ÙƒØªÙˆØ¨Ø±","Ù†ÙˆÙÙ…Ø¨Ø±","Ø¯ÙŠØ³Ù…Ø¨Ø±"];
  const monthNames={
    en:["January","February","March","April","May","June","July","August","September","October","November","December"],
    fr:["janvier","fÃ©vrier","mars","avril","mai","juin","juillet","aoÃ»t","septembre","octobre","novembre","dÃ©cembre"]
  };
  const weekdays={
    ar:["Ø­","Ù†","Ø«","Ø±","Ø®","Ø¬","Ø³"], // Ø£Ø­Ø¯..Ø³Ø¨Øª
    en:["S","M","T","W","T","F","S"],
    fr:["D","L","M","M","J","V","S"]
  };

  let currentLang='ar';

  function changeLang(lang){
    currentLang=lang;
    document.body.dir = (lang==='ar')?'rtl':'ltr';
    document.getElementById('title').innerText=texts[lang].title;
    document.getElementById('labelLastPeriod').innerText=texts[lang].labelLastPeriod;
    document.getElementById('labelCycleLength').innerText=texts[lang].labelCycleLength;
    document.getElementById('btnCalculate').innerText=texts[lang].btnCalculate;
    document.getElementById('reasonQuestion').innerText=texts[lang].reasonQuestion;
    document.querySelector('.reason-btn.conceive').innerText=texts[lang].reasonConceive;
    document.querySelector('.reason-btn:not(.conceive)').innerText=texts[lang].reasonPrevent;
    // Legend texts
    document.getElementById('lgPeriod').innerText=texts[lang].legend.period;
    document.getElementById('lgFertile').innerText=texts[lang].legend.fertile;
    document.getElementById('lgOvul').innerText=texts[lang].legend.ovul;

    // reset outputs on language change
    document.getElementById('result').innerText='';
    document.getElementById('cycleNotification').style.display='none';
    document.getElementById('reasonSection').style.display='none';
    document.getElementById('adviceBox').style.display='none';
    document.getElementById('calendarContainer').style.display='none';
  }

  function formatDate(date){
    const d=date.getDate(), y=date.getFullYear();
    if(currentLang==='ar'){
      const m=frenchMonthsInArabic[date.getMonth()];
      return `${d} ${m} ${y}`;
    }else{
      return date.toLocaleDateString(currentLang,{day:'numeric',month:'long',year:'numeric'});
    }
  }

  // Ù†ØµØ§Ø¦Ø­ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù„ÙƒÙ„ Ù„ØºØ© ÙˆØ³Ø¨Ø¨
  const advices={
    ar:{
      conceive:[
        ["Ù…Ø§Ø±Ø³ÙŠ Ø§Ù„Ø¬Ù…Ø§Ø¹ ÙƒÙ„ 1â€“2 ÙŠÙˆÙ… Ø®Ù„Ø§Ù„ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø£ÙƒØ«Ø± Ø®ØµÙˆØ¨Ø©.",
         "Ø§Ù‡ØªÙ…ÙŠ Ø¨Ø­Ù…Ø¶ Ø§Ù„ÙÙˆÙ„ÙŠÙƒ ÙˆÙÙŠØªØ§Ù…ÙŠÙ† D ÙˆØ­Ø¯ÙŠØ¯ Ø¶Ù…Ù† Ù†Ø¸Ø§Ù…Ùƒ Ø§Ù„ØºØ°Ø§Ø¦ÙŠ.",
         "Ø®ÙÙ‘Ø¶ÙŠ Ø§Ù„ØªÙˆØªØ± ÙˆØ§Ø­ØµÙ„ÙŠ Ø¹Ù„Ù‰ Ù†ÙˆÙ… ÙƒØ§ÙÙ â€” ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®ØµÙˆØ¨Ø©.",
         "Ø±Ø§Ø¬Ø¹ÙŠ Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø¥Ø°Ø§ ØªØ£Ø®Ø± Ø§Ù„Ø­Ù…Ù„ Ø£ÙƒØ«Ø± Ù…Ù† 12 Ø´Ù‡Ø±Ù‹Ø§ (6 Ø£Ø´Ù‡Ø± Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ø±>35)."],
        ["Ø±Ø§Ù‚Ø¨ÙŠ Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø¥Ø¨Ø§Ø¶Ø© (Ø­Ø±Ø§Ø±Ø© Ù‚Ø§Ø¹Ø¯ÙŠØ©/Ø¥ÙØ±Ø§Ø²Ø§Øª Ø´ÙØ§ÙØ©).",
         "ØªØ¬Ù†Ø¨ÙŠ Ø§Ù„ØªØ¯Ø®ÙŠÙ† ÙˆØ§Ù„ÙƒØ­ÙˆÙ„ Ù„ØªØ­Ø³ÙŠÙ† Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¨ÙˆÙŠØ¶Ø§Øª ÙˆØ§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ÙˆÙŠØ©.",
         "Ø­Ø§ÙØ¸ÙŠ Ø¹Ù„Ù‰ ÙˆØ²Ù† ØµØ­ÙŠØ› Ø§Ù„ÙˆØ²Ù† ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¨Ø§Ø¶Ø©."]
      ],
      prevent:[
        ["ØªØ¬Ù†Ù‘Ø¨ÙŠ Ø§Ù„Ø¬Ù…Ø§Ø¹ ÙÙŠ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø£ÙƒØ«Ø± Ø®ØµÙˆØ¨Ø© Ø¥Ø°Ø§ Ù„Ø§ ØªØ±ØºØ¨ÙŠÙ† Ø¨Ø§Ù„Ø­Ù…Ù„.",
         "Ø§Ø³ØªØ®Ø¯Ù…ÙŠ ÙˆØ³ÙŠÙ„Ø© ÙØ¹Ù‘Ø§Ù„Ø© (Ø­Ø¨ÙˆØ¨/Ù„ÙˆÙ„Ø¨/Ù„Ø§ØµÙ‚Ø©/Ø­Ù‚Ù†) Ø¨Ø§Ù„ØªØ´Ø§ÙˆØ± Ù…Ø¹ Ø§Ù„Ø·Ø¨ÙŠØ¨Ø©.",
         "Ù„Ø§ ØªØ¹ØªÙ…Ø¯ÙŠ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© Ø¥Ù„Ø§ Ù…Ø¹ Ø¯ÙˆØ±Ø§Øª Ù…Ù†ØªØ¸Ù…Ø© ÙˆØ³Ø¬Ù„Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø©."],
        ["Ø§Ø³ØªØ®Ø¯Ù…ÙŠ Ø§Ù„ÙˆØ§Ù‚ÙŠ Ø§Ù„Ø°ÙƒØ±ÙŠ Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ø²Ø¯ÙˆØ¬Ø© (Ø§Ù„Ø­Ù…Ù„/Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø© Ø¬Ù†Ø³ÙŠÙ‹Ø§).",
         "Ø¯ÙˆÙ‘Ù†ÙŠ ØªÙˆØ§Ø±ÙŠØ® Ø¯ÙˆØ±ØªÙƒ Ù„ØªÙ‚Ù„ÙŠÙ„ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨.",
         "ÙÙƒÙ‘Ø±ÙŠ Ø¨ÙˆØ³ÙŠÙ„Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙÙŠ ÙØªØ±Ø§Øª Ø¹Ø¯Ù… Ø§Ù„Ø§Ù†ØªØ¸Ø§Ù…."]
      ]
    },
    en:{
      conceive:[
        ["Have intercourse every 1â€“2 days during the fertile window.",
         "Include folic acid, vitamin D and iron in your diet.",
         "Reduce stress and sleep well â€” both affect fertility.",
         "Consult a doctor if no pregnancy after 12 months (6 months if >35)."],
        ["Track ovulation signs (BBT/cervical mucus).",
         "Avoid smoking and excessive alcohol to improve egg/sperm quality.",
         "Maintain a healthy weight; it influences ovulation."]
      ],
      prevent:[
        ["Avoid intercourse on the most fertile days.",
         "Use reliable contraception (pill, IUD, patch, injection) after medical advice.",
         "Natural family planning requires regular cycles and precise tracking."],
        ["Use condoms for dual protection (pregnancy & STIs).",
         "Keep accurate cycle records to reduce calculation mistakes.",
         "Consider a backup method during irregular cycles."]
      ]
    },
    fr:{
      conceive:[
        ["Ayez des rapports tous les 1â€“2 jours pendant la pÃ©riode fertile.",
         "Apportez acide folique, vitamine D et fer dans votre alimentation.",
         "RÃ©duisez le stress et dormez suffisamment â€” cela influence la fertilitÃ©.",
         "Consultez un mÃ©decin si aucune grossesse aprÃ¨s 12 mois (6 mois si >35 ans)."],
        ["Suivez les signes dâ€™ovulation (TB/ glaire cervicale).",
         "Ã‰vitez tabac et alcool excessif pour une meilleure qualitÃ© ovocytaire/spermatique.",
         "Maintenez un poids santÃ© ; il influence lâ€™ovulation."]
      ],
      prevent:[
        ["Ã‰vitez les rapports les jours les plus fertiles.",
         "Utilisez une contraception fiable (pilule, DIU, patch, injection) aprÃ¨s avis mÃ©dical.",
         "La planification naturelle requiert des cycles rÃ©guliers et un suivi prÃ©cis."],
        ["Utilisez des prÃ©servatifs pour une double protection (grossesse & IST).",
         "Notez vos cycles pour limiter les erreurs de calcul.",
         "PrÃ©voyez une mÃ©thode de secours en cas dâ€™irrÃ©gularitÃ©s."]
      ]
    }
  };

  function calculateOvulation(){
    const lastPeriodInput=document.getElementById("lastPeriod").value;
    const cycleLengthInput=document.getElementById("cycleLength").value;
    const resultDiv=document.getElementById("result");
    const notif=document.getElementById("cycleNotification");

    const lpDate=new Date(lastPeriodInput);
    const cycleLength=parseInt(cycleLengthInput,10);

    if(!lastPeriodInput || isNaN(lpDate.getTime()) || isNaN(cycleLength)){
      resultDiv.innerText=texts[currentLang].error;
      notif.style.display="none";
      document.getElementById('reasonSection').style.display='none';
      document.getElementById('adviceBox').style.display='none';
      document.getElementById('calendarContainer').style.display='none';
      return;
    }

    // Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    const ovulationDay=new Date(lpDate);
    ovulationDay.setDate(ovulationDay.getDate() + (cycleLength - 14));

    const fertileStart=new Date(ovulationDay);
    fertileStart.setDate(fertileStart.getDate()-5);

    const fertileEnd=new Date(ovulationDay); // Ø­ØªÙ‰ ÙŠÙˆÙ… Ø§Ù„Ø¥Ø¨Ø§Ø¶Ø© (Ø¶Ù…Ù†ÙŠÙ‹Ø§)

    const periodLength=5; // ØªÙ‚Ø¯ÙŠØ±ÙŠ
    const periodDays=[];
    for(let i=0;i<periodLength;i++){
      const d=new Date(lpDate);
      d.setDate(d.getDate()+i);
      periodDays.push(d);
    }

    const nextPeriod=new Date(lpDate);
    nextPeriod.setDate(nextPeriod.getDate()+cycleLength);

    // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: Ø³Ø·Ø±ÙŠÙ† Ù…Ù†ÙØµÙ„ÙŠÙ†
    resultDiv.innerHTML = `
      <div class="line">${texts[currentLang].ovulation}</div>
      <div class="circle-date">${formatDate(ovulationDay)}</div>
      <div class="line fertile-line" style="margin-top:10px;">${texts[currentLang].fertileWindow}
        <strong>${formatDate(fertileStart)}</strong> ${texts[currentLang].to} <strong>${formatDate(fertileEnd)}</strong>
      </div>
      <div class="small-note" style="margin-top:10px;">${texts[currentLang].nextPeriod} <strong>${formatDate(nextPeriod)}</strong></div>
    `;

    // ØªÙ†Ø¨ÙŠÙ‡ Ù†ÙˆØ¹ Ø§Ù„Ø¯ÙˆØ±Ø©
    if(cycleLength>=26 && cycleLength<=32){
      notif.innerText=texts[currentLang].regular;
      notif.style.backgroundColor="#d4edda";notif.style.color="#155724";
    }else{
      notif.innerText=texts[currentLang].irregular;
      notif.style.backgroundColor="#f8d7da";notif.style.color="#721c24";
    }
    notif.style.display="block";

    // Ø§Ù„ØªÙ‚ÙˆÙŠÙ…: Ø´Ù‡Ø± ÙŠÙˆÙ… Ø§Ù„Ø¥Ø¨Ø§Ø¶Ø©
    buildCalendar(ovulationDay, periodDays, fertileStart, fertileEnd, ovulationDay);

    // Ø¥Ø¸Ù‡Ø§Ø± Ø³Ø¨Ø¨ Ø§Ù„Ø¨Ø­Ø«
    document.getElementById('reasonQuestion').innerText=texts[currentLang].reasonQuestion;
    document.querySelector('.reason-btn.conceive').innerText=texts[currentLang].reasonConceive;
    document.querySelector('.reason-btn:not(.conceive)').innerText=texts[currentLang].reasonPrevent;
    document.getElementById('reasonSection').style.display='block';

    // Ø¥Ø®ÙØ§Ø¡ Ù†ØµÙŠØ­Ø© Ø³Ø§Ø¨Ù‚Ø©
    document.getElementById('adviceBox').style.display='none';
    document.getElementById('adviceBox').innerHTML='';

    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªÙ‚ÙˆÙŠÙ… ÙˆØ§Ù„Ù…ÙØªØ§Ø­
    document.getElementById('calendarContainer').style.display='block';

    document.getElementById("successSound").play();
  }

  function sameDay(a,b){
    return a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth() && a.getDate()===b.getDate();
  }
  function inRange(date, start, end){
    return date >= start && date <= end;
  }

  function buildCalendar(refDate, periodDays, fertileStart, fertileEnd, ovulationDay){
    const year=refDate.getFullYear();
    const month=refDate.getMonth();

    const firstOfMonth=new Date(year,month,1);
    const startDayIdx=firstOfMonth.getDay(); // 0 Ø§Ù„Ø£Ø­Ø¯
    const daysInMonth=new Date(year,month+1,0).getDate();

    // Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙ‚ÙˆÙŠÙ…
    const calTitle=document.getElementById('calTitle');
    if(currentLang==='ar'){
      calTitle.textContent = `${frenchMonthsInArabic[month]} ${year}`;
    }else{
      const name = (currentLang==='en'?monthNames.en[month]:monthNames.fr[month]);
      calTitle.textContent = `${name} ${year}`;
    }

    const grid=document.getElementById('calGrid');
    grid.innerHTML='';

    // ØµÙ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£ÙŠØ§Ù…
    weekdays[currentLang].forEach(w=>{
      const el=document.createElement('div');
      el.className='dow';
      el.textContent=w;
      grid.appendChild(el);
    });

    // ÙØ±Ø§ØºØ§Øª Ù‚Ø¨Ù„ Ø§Ù„ÙŠÙˆÙ… 1
    for(let i=0;i<startDayIdx;i++){
      const ph=document.createElement('div');
      ph.className='day muted';
      ph.style.visibility='hidden';
      grid.appendChild(ph);
    }

    // Ø£ÙŠØ§Ù… Ø§Ù„Ø´Ù‡Ø±
    for(let d=1; d<=daysInMonth; d++){
      const dt=new Date(year,month,d);
      const cell=document.createElement('div');
      cell.className='day';
      cell.textContent=d;

      // ØªÙ„ÙˆÙŠÙ† Ø§Ù„ÙØªØ±Ø© â€” Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ù„ÙŠÙˆÙ… Ø§Ù„Ø¥Ø¨Ø§Ø¶Ø©ØŒ Ø«Ù… Ø®ØµÙˆØ¨Ø©ØŒ Ø«Ù… Ø§Ù„Ø¯ÙˆØ±Ø©
      if(sameDay(dt, ovulationDay)){
        cell.classList.add('ovul');
      }else if(inRange(dt, fertileStart, fertileEnd)){
        cell.classList.add('fertile');
      }
      // ØªÙ„ÙˆÙŠÙ† Ø£ÙŠØ§Ù… Ø§Ù„Ø¯ÙˆØ±Ø© (Ù„Ù†ÙØ³ Ø§Ù„Ø´Ù‡Ø± ÙÙ‚Ø·)
      for(const pd of periodDays){
        if(sameDay(dt,pd)) { cell.classList.remove('fertile'); cell.classList.add('period'); break; }
      }

      grid.appendChild(cell);
    }

    // ØªØ­Ø¯ÙŠØ« Ù†ØµÙˆØµ Ø§Ù„Ù€ Legend Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ© (ØªÙ… Ø£ÙŠØ¶Ø§Ù‹ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©)
    document.getElementById('lgPeriod').innerText=texts[currentLang].legend.period;
    document.getElementById('lgFertile').innerText=texts[currentLang].legend.fertile;
    document.getElementById('lgOvul').innerText=texts[currentLang].legend.ovul;
  }

  function showAdvice(type){
    const listSets=advices[currentLang] && advices[currentLang][type];
    if(!listSets) return;
    const randomSet=listSets[Math.floor(Math.random()*listSets.length)];
    let title='';
    if(currentLang==='ar') title = (type==='conceive')?'Ù†ØµØ§Ø¦Ø­ Ù„Ø²ÙŠØ§Ø¯Ø© ÙØ±Øµ Ø§Ù„Ø­Ù…Ù„:':'Ù†ØµØ§Ø¦Ø­ Ù„Ù…Ù†Ø¹ Ø§Ù„Ø­Ù…Ù„:';
    else if(currentLang==='en') title = (type==='conceive')?'Tips to increase pregnancy chances:':'Tips to avoid pregnancy:';
    else title = (type==='conceive')?'Conseils pour augmenter les chances de grossesse :':'Conseils pour Ã©viter une grossesse :';

    let html=`<strong>${title}</strong><ul>`;
    randomSet.forEach(item=>{ html+=`<li>${item}</li>`; });
    html+='</ul>';

    const box=document.getElementById('adviceBox');
    box.innerHTML=html;
    box.style.display='block';
  }

  // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ
  changeLang('ar');
</script>
</body>
</html>
